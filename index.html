<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo da velha</title>
</head>
<body>
    <div id="root"></div>
     <script src="https://unpkg.com/react@17.0.0/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17.0.0/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.12.4/babel.js"></script>
  <script src="https://unpkg.com/prop-types@15.7.2/prop-types.js"></script>
  <script type="module">
        function useLocalStorageState(
	  key,
	  defaultValue = '',
	  {serialize = JSON.stringify, deserialize = JSON.parse} = {},
	) {
	  const [state, setState] = React.useState(() => {
	    const valueInLocalStorage = window.localStorage.getItem(key)
	    if (valueInLocalStorage) {
	      return deserialize(valueInLocalStorage)
	    }
	    return typeof defaultValue === 'function' ? defaultValue() : defaultValue
	  })

	  const prevKeyRef = React.useRef(key)

	  React.useEffect(() => {
	    const prevKey = prevKeyRef.current
	    if (prevKey !== key) {
	      window.localStorage.removeItem(prevKey)
	    }
	    prevKeyRef.current = key
	    window.localStorage.setItem(key, serialize(state))
	  }, [key, state, serialize])

	  return [state, setState]
	}
        function Board({onClick, squares}) {
	 
	  function renderSquare(i) {
	    return (
	      <button className="square" onClick={() => onClick(i)}>
		{squares[i]}
	      </button>
	    )
	  }

	  return (
	    <div>
	      <div className="board-row">
		{renderSquare(0)}
		{renderSquare(1)}
		{renderSquare(2)}
	      </div>
	      <div className="board-row">
		{renderSquare(3)}
		{renderSquare(4)}
		{renderSquare(5)}
	      </div>
	      <div className="board-row">
		{renderSquare(6)}
		{renderSquare(7)}
		{renderSquare(8)}
	      </div>
	    </div>
	  )
	}

	function Game() {
	  const [currentStep, setCurrentStep] = useLocalStorageState('tic-tac: step', 0)
	  const [history, setHistory] = useLocalStorageState('tic-tac: step', Array(9).fill(null))
	  
	  const currentSquare = history[currentStep]
	  const nextValue = calculateNextValue(currentSquare)
	  const winner = calculateWinner(currentSquare)
	  const status = calculateStatus(currentSquare)

	  function calculateStatus(winner, squares, nextValue) {
	    return winner
	      ? `Winner: ${winner}`
	      : currentSquare.every(Boolean)
	      ? `Scratch: Cat's game`
	      : `Next player: ${nextValue}`
	  }
	  
	  function selectSquare(square) {    
	    if(winner || currentSquare(square)) return

	    const newHistory = history.slice(0, currentStep + 1)
	    const squaresCopy = [...currentSquare]
	    squaresCopy[square] = nextValue

	    setHistory([...newHistory, squaresCopy])
	    setCurrentStep(newHistory.length)

	  }

	  function restart() {
	    setHistory([Array(9).fill(null)])
	    setCurrentStep(0)
	  }

	  const moves = history.map((stepSquares, index) => {
	    const desc = index === 0 ? 'Go to start' : `Go to move #${index}`
	    const isCurrentStep = index === currentStep
	    return (
	      <li key={index}>
		<button disabled={isCurrentStep} onClick={() => setCurrentStep(index)}>
		  {desc} {isCurrentStep ? 'current' : null}
		</button>
	      </li>
	    )
	  })

	  return (
	    <div className="game">
	      <div className="game-board">
		<Board onClick={selectSquare} squares={currentSquare} />
		<button className="restart" onClick={restart}>
		  Restart
		</button>
	      </div>
	      <div className="game-info">
		<div>{status}</div>
		<ol>{moves}</ol>
	      </div>
	    </div>
	  )
	}

	function calculateNextValue(squares) {
	  return squares.filter(Boolean).length % 2 === 0 ? 'X' : 'O'
	}

	function calculateWinner(squares) {
	  const lines = [
	    [0, 1, 2],
	    [3, 4, 5],
	    [6, 7, 8],
	    [0, 3, 6],
	    [1, 4, 7],
	    [2, 5, 8],
	    [0, 4, 8],
	    [2, 4, 6],
	  ]
	  for (let i = 0; i < lines.length; i++) {
	    const [a, b, c] = lines[i]
	    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {
	      return squares[a]
	    }
	  }
	  return null
	}

	function App() {
	  return <Game />
	}

         
            ReactDOM.render(App, document.getElementById('root'))
    </script>
</body>
</html>
